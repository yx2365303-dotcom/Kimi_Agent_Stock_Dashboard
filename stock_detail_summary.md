# 个股详情页模块设计总结

## 设计概述

本设计方案基于tushare提供的11个核心数据表，为股票数据看板设计了一个功能完整、性能优异的个股详情页模块。

---

## 一、核心功能模块

| 模块 | 功能描述 | 数据依赖 |
|------|----------|----------|
| **股票头部信息** | 展示股票名称、代码、当前价、涨跌幅、成交量等 | stock_basic, daily |
| **K线图** | 日K/周K/月K切换，支持前复权/后复权 | daily, adj_factor |
| **分时图** | 实时价格走势、均价线、成交量 | 实时行情数据 |
| **技术指标** | MACD、KDJ、RSI、布林带、均线等 | stk_factor, stk_factor_pro |
| **五档盘口** | 买卖五档价格和数量 | 实时盘口数据 |
| **成交明细** | 实时成交记录 | 实时成交数据 |
| **资金流向** | 主力/散户资金流向分析 | moneyflow, moneyflow_dc |
| **筹码分布** | 筹码分布图、成本区间、获利比例 | cyq_chips, cyq_perf |
| **基本面数据** | PE、PB、市值、换手率等 | daily_basic |
| **财务指标** | 盈利能力、偿债能力、成长能力 | fina_indicator |
| **新闻公告** | 公司新闻、公告、研报 | 新闻API |

---

## 二、页面布局设计

### 桌面端布局 (lg ≥1440px)

```
┌─────────────────────────────────────────────────────────────────┐
│  顶部导航栏                                                      │
├─────────────────────────────────────────────────────────────────┤
│  股票基本信息区 (名称/价格/涨跌/成交量/操作按钮)                 │
├─────────────────────────────┬───────────────────────────────────┤
│                             │                                   │
│      主图表区 (65%)         │      盘口交易区 (35%)            │
│  ┌─────────────────────┐    │  ┌─────────────────────────┐     │
│  │   K线图/分时图      │    │  │      五档买卖盘         │     │
│  │  [日K][周K][月K]    │    │  │  卖五/四/三/二/一       │     │
│  │  [前复权][后复权]   │    │  │  买一/二/三/四/五       │     │
│  └─────────────────────┘    │  └─────────────────────────┘     │
│  ┌─────────────────────┐    │  ┌─────────────────────────┐     │
│  │   技术指标副图      │    │  │      成交明细           │     │
│  │  (MACD/KDJ/RSI)     │    │  │  时间/价格/量/方向      │     │
│  └─────────────────────┘    │  └─────────────────────────┘     │
│                             │                                   │
├─────────────────────────────┴───────────────────────────────────┤
│  [资金流向][筹码分布][基本面][财务指标][新闻公告][相关股票]     │
├─────────────────────────────────────────────────────────────────┤
│  详细数据展示区 (根据Tab切换显示不同内容)                       │
└─────────────────────────────────────────────────────────────────┘
```

### 响应式断点

| 断点 | 宽度 | 布局调整 |
|------|------|----------|
| xl | ≥1920px | 主图表区70% + 盘口区30% |
| lg | ≥1440px | 主图表区65% + 盘口区35% (标准布局) |
| md | ≥1024px | 主图表区60% + 盘口区40%，盘口精简 |
| sm | ≥768px | 单列布局，盘口移至图表下方 |
| xs | <768px | 单列布局，Tab横向滚动 |

---

## 三、组件层次结构

### 组件树概览

```
StockDetailPage (页面级)
├── StockHeader (容器级)
│   ├── StockBasicInfo (展示级)
│   ├── TradingStats (展示级)
│   └── ActionButtons (交互级)
├── MainChartSection (容器级)
│   ├── ChartToolbar (交互级)
│   ├── KLineChart (图表级)
│   ├── TimeSeriesChart (图表级)
│   └── SubIndicatorChart (图表级)
├── OrderBookSection (容器级)
│   ├── FiveLevelOrder (展示级)
│   ├── TradeDetails (展示级)
│   └── QuickTrade (交互级)
└── DetailPanelSection (容器级)
    ├── MoneyFlowPanel (容器级)
    ├── ChipDistributionPanel (容器级)
    ├── FundamentalPanel (容器级)
    ├── FinancialPanel (容器级)
    ├── NewsPanel (容器级)
    └── RelatedStocksPanel (容器级)
```

---

## 四、数据获取策略

### 数据获取优先级

| 优先级 | 数据类型 | 获取时机 | 缓存策略 | 数据源 |
|--------|----------|----------|----------|--------|
| **P0** | 股票基本信息 | 页面加载立即获取 | 24小时 | stock_basic |
| **P0** | 日线行情数据 | 页面加载立即获取 | 1小时 | daily + adj_factor |
| **P0** | 实时行情 | WebSocket连接 | 不缓存 | WebSocket |
| **P1** | 技术指标 | 图表渲染时获取 | 30分钟 | stk_factor |
| **P1** | 盘口数据 | WebSocket连接 | 不缓存 | WebSocket |
| **P2** | 资金流向 | Tab切换时获取 | 15分钟 | moneyflow |
| **P2** | 筹码分布 | Tab切换时获取 | 15分钟 | cyq_chips |
| **P3** | 基本面数据 | Tab切换时获取 | 4小时 | daily_basic |
| **P3** | 财务指标 | Tab切换时获取 | 24小时 | fina_indicator |
| **P4** | 新闻公告 | 滚动懒加载 | 10分钟 | 新闻API |

### 数据分层架构

```
┌─────────────────────────────────────────┐
│  数据展示层 (React/Vue Components)      │
├─────────────────────────────────────────┤
│  状态管理层 (Zustand/Pinia)             │
├─────────────────────────────────────────┤
│  数据服务层 (API Client + Cache)        │
├─────────────────────────────────────────┤
│  数据源层 (Tushare + WebSocket + Redis) │
└─────────────────────────────────────────┘
```

---

## 五、推荐技术栈

### 图表库选择

| 图表库 | 用途 | 推荐理由 |
|--------|------|----------|
| **TradingView Lightweight Charts** | K线图、分时图 | 专业金融图表、性能优秀、内置技术指标 |
| **Apache ECharts** | 统计图表、复杂可视化 | 功能全面、中文文档完善、社区活跃 |

### 状态管理方案

| 框架 | 推荐方案 | 理由 |
|------|----------|------|
| React | **Zustand** | 轻量、易用、TypeScript友好 |
| Vue | **Pinia** | 官方推荐、组合式API支持 |

### 其他技术选型

| 类别 | 推荐方案 |
|------|----------|
| 构建工具 | Vite |
| UI组件库 | Ant Design / Element Plus |
| 数据请求 | TanStack Query / SWR |
| WebSocket | Socket.io / Native WebSocket |
| 缓存 | IndexedDB + Memory Cache |

---

## 六、性能优化建议

### 数据优化

| 策略 | 实现方式 | 预期效果 |
|------|----------|----------|
| 数据分页 | K线首次加载200条 | 减少70%初始数据量 |
| 数据压缩 | 使用protobuf传输 | 减少50%传输体积 |
| 增量更新 | 只请求新增数据 | 减少80%后续请求 |
| 数据预取 | 预测用户行为提前加载 | 提升50%响应速度 |

### 渲染优化

| 策略 | 实现方式 | 预期效果 |
|------|----------|----------|
| 虚拟滚动 | 成交明细长列表 | 提升60%渲染性能 |
| 组件懒加载 | Tab面板按需加载 | 减少30%初始加载时间 |
| 图表优化 | Canvas渲染、数据点限制 | 提升40%图表性能 |

### 网络优化

- WebSocket心跳检测 (30秒)
- 自动重连机制 (最多5次)
- 请求合并与去重
- 批量推送 (100ms间隔)

---

## 七、复权处理方案

### 复权类型

| 类型 | 说明 | 适用场景 |
|------|------|----------|
| 不复权 | 原始价格数据 | 查看真实交易价格 |
| 前复权 | 以最新价格为基准 | 分析近期走势 |
| 后复权 | 以最早价格为基准 | 分析长期趋势 |

### 复权计算

```typescript
// 前复权计算
adjustRatio = factor / latestFactor

// 后复权计算
adjustRatio = factor / firstFactor

// 应用复权
adjustedPrice = originalPrice * adjustRatio
```

---

## 八、技术指标配置

| 指标 | 数据来源 | 展示方式 |
|------|----------|----------|
| MACD | stk_factor | 副图 (DIF/DEA/MACD柱状) |
| KDJ | stk_factor | 副图 (K/D/J三线) |
| RSI | stk_factor | 副图 (RSI6/12/24) |
| 布林带 | stk_factor | 主图叠加 (上轨/中轨/下轨) |
| MA均线 | stk_factor_pro | 主图叠加 (MA5/10/20/30/60) |

---

## 九、生成文件列表

| 文件名 | 说明 |
|--------|------|
| `stock_detail_page_design.md` | 详细设计文档 |
| `stock_detail_summary.md` | 设计总结文档 (本文件) |
| `stock_detail_component_hierarchy.png` | 组件层次结构图 |
| `stock_detail_data_flow.png` | 数据流架构图 |
| `stock_detail_page_layout.png` | 页面布局设计图 |
| `stock_detail_data_tables.png` | 数据表关系图 |
| `stock_detail_tech_stack.png` | 技术栈推荐图 |

---

## 十、开发建议

### 目录结构

```
src/
├── components/stock/
│   ├── StockHeader/
│   ├── KLineChart/
│   ├── OrderBook/
│   ├── MoneyFlowPanel/
│   ├── ChipDistribution/
│   ├── FundamentalPanel/
│   └── FinancialPanel/
├── hooks/
│   ├── useStockData.ts
│   ├── useRealtimeData.ts
│   └── useKLineData.ts
├── services/
│   ├── stockApi.ts
│   ├── websocketService.ts
│   └── cacheService.ts
├── stores/
│   └── stockDetailStore.ts
└── utils/
    ├── adjustCalculation.ts
    └── chartHelpers.ts
```

### 关键实现要点

1. **K线图**：使用 TradingView Lightweight Charts，支持多周期切换
2. **实时数据**：WebSocket连接，自动重连和心跳检测
3. **数据缓存**：内存缓存 + IndexedDB，多层缓存策略
4. **性能优化**：虚拟滚动、数据分页、组件懒加载
5. **响应式**：适配桌面端和移动端

---

## 设计亮点

1. **专业图表**：采用TradingView专业金融图表库，提供机构级体验
2. **实时推送**：WebSocket实现毫秒级数据更新
3. **智能缓存**：多层缓存策略，平衡实时性与性能
4. **响应式设计**：完美适配各种屏幕尺寸
5. **模块化架构**：组件职责清晰，易于维护和扩展
